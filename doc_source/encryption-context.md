# Encryption Context<a name="encryption-context"></a>

*Encryption context* is a set of key\-value pairs that you can pass to AWS KMS when you call the [http://docs.aws.amazon.com/kms/latest/APIReference/API_Encrypt.html](http://docs.aws.amazon.com/kms/latest/APIReference/API_Encrypt.html), [http://docs.aws.amazon.com/kms/latest/APIReference/API_Decrypt.html](http://docs.aws.amazon.com/kms/latest/APIReference/API_Decrypt.html), [http://docs.aws.amazon.com/kms/latest/APIReference/API_ReEncrypt.html](http://docs.aws.amazon.com/kms/latest/APIReference/API_ReEncrypt.html), [http://docs.aws.amazon.com/kms/latest/APIReference/API_GenerateDataKey.html](http://docs.aws.amazon.com/kms/latest/APIReference/API_GenerateDataKey.html), and [http://docs.aws.amazon.com/kms/latest/APIReference/API_GenerateDataKeyWithoutPlaintext.html](http://docs.aws.amazon.com/kms/latest/APIReference/API_GenerateDataKeyWithoutPlaintext.html) APIs\. It is checked for integrity but not stored as part of the ciphertext that is returned\. Although the encryption context is not included in the ciphertext, it is cryptographically bound to the ciphertext during encryption and must be passed again when you call the [http://docs.aws.amazon.com/kms/latest/APIReference/API_Decrypt.html](http://docs.aws.amazon.com/kms/latest/APIReference/API_Decrypt.html) \(or [http://docs.aws.amazon.com/kms/latest/APIReference/API_ReEncrypt.html](http://docs.aws.amazon.com/kms/latest/APIReference/API_ReEncrypt.html)\) API\. Decryption only succeeds if the encryption context you pass for decryption is exactly the same as the encryption context you passed during encryption\. The encryption context is logged by AWS CloudTrail\.

To learn how to use encryption context to protect the integrity of encrypted data, see the post [How to Protect the Integrity of Your Encrypted Data by Using AWS Key Management Service and EncryptionContext](https://aws.amazon.com/blogs/security/how-to-protect-the-integrity-of-your-encrypted-data-by-using-aws-key-management-service-and-encryptioncontext/) on the AWS Security Blog\.

Encryption context can consist of any values that you want\. However, because it is not encrypted and because it is logged if CloudTrail logging is turned on, your encryption context should not include sensitive information\. We further recommend that your encryption context describe the data being encrypted or decrypted so that you can better understand the CloudTrail log entries produced by AWS KMS\. For example, Amazon EBS uses the ID of the encrypted volume as the encryption context for server\-side encryption\. If you are encrypting a file, you might use part of the file path as encryption context\.

**Topics**
+ [Encryption Context in Grants and Key Policies](#encryption-context-authorization)
+ [Logging Encryption Context](#encryption-context-auditing)
+ [Storing Encryption Context](#encryption-context-storing)

## Encryption Context in Grants and Key Policies<a name="encryption-context-authorization"></a>

In addition to using encryption context to check ciphertext integrity and authenticity, AWS KMS supports authorization by using grants and key policies that incorporate encryption context\. Authorization that uses encryption context more tightly controls access to encrypted resources\. When you [create a grant](http://docs.aws.amazon.com/kms/latest/APIReference/API_CreateGrant.html), for example, you can optionally specify a set of constraints that specify an encryption context that unambiguously identifies the resource to which long\-term access is being granted\. For example, consider encrypted volumes with Amazon EBS and Amazon EC2: When an EBS volume is attached to an EC2 instance, a grant is created that allows only that instance to decrypt only that volume\. This is accomplished by encoding the volume ID as the encryption context in the [http://docs.aws.amazon.com/kms/latest/APIReference/API_GrantConstraints.html](http://docs.aws.amazon.com/kms/latest/APIReference/API_GrantConstraints.html) that is passed to the [http://docs.aws.amazon.com/kms/latest/APIReference/API_CreateGrant.html](http://docs.aws.amazon.com/kms/latest/APIReference/API_CreateGrant.html) API\. Without the encryption context in the constraint, the Amazon EC2 instance would obtain access to all volumes encrypted under the customer master key \(CMK\) rather than a specific volume\.

## Logging Encryption Context<a name="encryption-context-auditing"></a>

AWS KMS uses AWS CloudTrail to log the encryption context so you can determine which CMKs and data have been accessed\. That is, the log entry shows exactly which CMK was used to encrypt or decrypt specific data referenced by the encryption context in the log entry\.

**Important**  
Because the encryption context is logged, it must not contain sensitive information\.

## Storing Encryption Context<a name="encryption-context-storing"></a>

You should store the encryption context alongside the encrypted data to simplify using it when you call the [http://docs.aws.amazon.com/kms/latest/APIReference/API_Decrypt.html](http://docs.aws.amazon.com/kms/latest/APIReference/API_Decrypt.html) \(or [http://docs.aws.amazon.com/kms/latest/APIReference/API_ReEncrypt.html](http://docs.aws.amazon.com/kms/latest/APIReference/API_ReEncrypt.html)\) API\. One security enhancement you might consider is to store only enough of the encryption context to help you create the full encryption context on the fly when needed for encryption or decryption\. For example, if you are encrypting a file and decide that the encryption context should be the full file path, store only part of that path alongside the encrypted file contents\. Then, when you need the full encryption context, reconstruct it from the stored fragment\. If someone then moves the file to a different location, when you recreate the encryption context, the context will be different and the decryption process will fail, indicating that your data has been tampered with\.